# requirements.md

## 개요:
Gemini API를 활용한 구독제 사주풀이 서비스.
Google 로그인(Clerk)과 토스페이먼츠 구독결제를 통해 사주 분석을 제공.
무료 회원은 3회, Pro 회원은 월 10회 분석 가능.

## 데이터:
- 비로그인 상태에서는 서비스 이용 불가 (홈 페이지만 접근 가능).
- 사용자 인증 정보는 Clerk를 통해 관리됩니다.
- 사용자별 분석 횟수, 구독 상태, 결제 정보는 데이터베이스에 저장됩니다.
- 사주 분석 결과는 사용자별로 데이터베이스에 저장되며, 대시보드에서 조회 가능합니다.
- 무료 회원은 `gemini-2.5-flash`, Pro 회원은 `gemini-2.5-pro` 모델을 사용합니다.

## 기능:
### 페이지 구성
- **홈 (랜딩페이지)**: 비로그인 접근 가능, 서비스 소개 및 로그인 유도
- **대시보드**: 사용자의 분석 목록 표시 (로그인 필수)
- **새 분석하기**: 성함, 생년월일, 출생시간, 성별 입력 후 사주 분석 실행 (로그인 필수)
- **분석 상세보기**: 저장된 분석 결과 상세 조회 (로그인 필수)
- **구독 관리**: 구독 상태 확인, Pro 구독/해지 관리 (로그인 필수)

### 구독 시스템
- **무료 회원**: 
  - 가입 시 3회 테스트 제공
  - 소진 후 Pro 구독 유도
- **Pro 회원**:
  - 월 10회 분석 가능
  - 매월 자동 결제 (토스페이먼츠)
  - 구독 취소 시 다음 결제일까지 혜택 유지
  - 취소 후 재활성화 가능 (다음 결제일 전까지)
  - 구독 해지 시 빌링키 삭제

### 사주 분석
- 입력 정보: 성함, 생년월일, 출생시간(선택), 성별
- 분석 내용:
  - 천간(天干)과 지지(地支) 계산
  - 오행(五行) 분석 (목, 화, 토, 금, 수)
  - 대운(大運)과 세운(歲運) 해석
  - 성격, 재운, 건강운, 연애운 종합 분석
- 마크다운 형식 출력
- 의료·법률 조언 및 확정적 미래 예측 금지

### 정기결제 처리
- Supabase cron으로 매일 02:00 실행
- 결제일 도래한 구독건 자동 결제
- 결제 성공: 테스트 횟수 충전 + 구독 기간 연장
- 결제 실패: 즉시 구독 해지 처리

### 인증 시스템
- Clerk SDK 기본 제공 컴포넌트 사용
- Google OAuth 로그인
- Clerk Webhook 연동

### 사주 분석 시스템 프롬프트 예시
import type { TestInput } from '@/types/test';

export const generateSajuPrompt = (input: TestInput): string => {
  return `당신은 20년 경력의 전문 사주팔자 상담사입니다.

**입력 정보**:
- 성함: ${input.name}
- 생년월일: ${input.birthDate}
- 출생시간: ${input.birthTime || '미상'}
- 성별: ${input.gender === 'male' ? '남성' : '여성'}

**분석 요구사항**:
1️⃣ 천간(天干)과 지지(地支) 계산
2️⃣ 오행(五行) 분석 (목, 화, 토, 금, 수)
3️⃣ 대운(大運)과 세운(歲運) 해석
4️⃣ 전반적인 성격, 재운, 건강운, 연애운 분석

**출력 형식**: 마크다운

**금지 사항**:
- 의료·법률 조언
- 확정적 미래 예측
- 부정적·공격적 표현`;
};
