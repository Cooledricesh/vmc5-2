 📝 버그 수정 요청 
  프롬프트

  ## 🔴 버그 리포트 및 TDD 수정 요청

  ### 현재 문제 상황
  - Clerk로 이메일 인증 회원가입은 성공적으로 완료됨
 - 하지만 Supabase users 테이블에 사용자 정보가 저장되지 않음
  - /dashboard 페이지 접근 시 401 인증  오류 발생
  - 예상 원인: Clerk와   Supabase 간 사용자 정보 동기화 로직 누락

  ### TDD 방식으로 해결해주세요

  #### 1단계: RED -
  실패하는 테스트 먼저   작성
  1. E2E 테스트 작성(`tests-e2e/auth-integration.spec.ts`)
     - Clerk 회원가입 플로우 테스트
     - Supabase DB 저장 확인 테스트
     - 대시보드 접근 권한 테스트

  2. 단위 테스트 작성
  (`src/features/auth/__tests__/`)
     - Clerk 웹훅핸들러 테스트
     - Supabase 사용자 생성 서비스 테스트
     - 인증 미들웨어 테스트

  3. 테스트 실행하여 실패 확인 후 결과 보고

  #### 2단계: GREEN -
  테스트 통과하는 최소   코드 구현
  1. Clerk 웹훅  엔드포인트 구현 (`/api/webhooks/clerk`)
  2. Supabase 사용자  동기화 로직 구현
  3. 인증 체크  미들웨어 수정
  4. 각 단계마다  테스트 실행하여  진행상황 확인

  #### 3단계: REFACTOR
   - 코드 개선
  1. 에러 처리 강화
  2. 타입 안정성 개선
  3. 중복 코드 제거
  4. 성능 최적화

  ### 구현 요구사항
  - Clerk user.created   이벤트 발생 시
  Supabase에 자동으로  사용자 정보 저장
  - Clerk userId를  Supabase의 auth_id로   매핑
  - 트랜잭션 처리로   데이터 일관성 보장
  - 실패 시 재시도   로직 구현
  - 적절한 로깅 추가

  ### 테스트 커버리지
  - 정상 케이스: 신규 가입 → DB 저장 →   대시보드 접근
  - 엣지 케이스: 중복   가입, 웹훅 중복   호출, DB 연결 실패
  - 에러 케이스: Clerk   API 실패, Supabase   오류

  ### 완료 조건
  □ 모든 테스트 작성 완료 (실패 상태)
  □ 기능 구현으로   테스트 통과
  □ 기존 테스트도 모두    통과
  □ 에러 핸들링 테스트   통과
  □ 문서화 완료

  테스트 주도 개발   원칙을 엄격히   지켜주세요. 
  테스트 없는 코드는   작성하지 마세요.